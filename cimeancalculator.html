<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confidence Interval Calculator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- JStat Library CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.9.3/jstat.min.js"></script>
    <!-- MathJax CDN -->
    <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        // MathJax configuration
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <style>
        /* Custom styles for the Inter font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Full viewport height */
            margin: 0;
        }
    </style>
</head>
<body class="selection:bg-indigo-300 selection:text-indigo-900">
    <div class="container mx-auto p-4 md:p-8 bg-white shadow-xl rounded-2xl max-w-md w-full border-t-4 border-indigo-500">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Confidence Interval Calculator</h1>

        <div class="space-y-4">
            <div>
                <label for="mean" class="block text-sm font-medium text-gray-700 mb-1">Sample Mean <span tabindex="-1" aria-hidden="true">$(\bar{x})$</span>:</label>
                <input type="number" id="mean" step="any" placeholder="Enter sample mean"
                       class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-base appearance-none transition-all duration-200 ease-in-out hover:border-indigo-400">
            </div>
            <div>
                <label for="stdDev" class="block text-sm font-medium text-gray-700 mb-1">Sample Standard Deviation <span tabindex="-1" aria-hidden="true">$(s)$</span>:</label>
                <input type="number" id="stdDev" step="any" placeholder="Enter sample standard deviation"
                       class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-base appearance-none transition-all duration-200 ease-in-out hover:border-indigo-400">
            </div>
            <div>
                <label for="sampleSize" class="block text-sm font-medium text-gray-700 mb-1">Sample Size <span tabindex="-1" aria-hidden="true">$(n)$</span>:</label>
                <input type="number" id="sampleSize" step="1" min="2" placeholder="Enter sample size (n > 1)"
                       class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-base appearance-none transition-all duration-200 ease-in-out hover:border-indigo-400">
            </div>
            <div>
                <label for="confidenceLevel" class="block text-sm font-medium text-gray-700 mb-1">Confidence Level (%):</label>
                <input type="number" id="confidenceLevel" step="0.1" min="0.1" max="99.9" value="95"
                       class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-base appearance-none transition-all duration-200 ease-in-out hover:border-indigo-400">
            </div>

            <!-- Error message display area -->
            <div id="errorMessage" class="text-red-600 text-sm mt-2 text-center hidden"></div>

            <button id="calculateBtn"
                    class="w-full bg-indigo-600 text-white py-3 px-4 rounded-md shadow-lg font-semibold text-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-transform transform hover:scale-105 active:scale-95 duration-200 ease-in-out">
                Calculate CI
            </button>
        </div>

        <div id="results" class="mt-8 p-6 bg-indigo-50 rounded-lg shadow-inner border border-indigo-200 text-gray-800 hidden">
            <h2 class="text-xl font-semibold text-indigo-800 mb-3 text-center">Results</h2>
            <p class="text-lg font-medium"><span id="displayConfidenceLevel" class="font-bold" text-indigo-700></span> Confidence Interval:</p>
            <p class="text-lg font-medium"><span id="lowerBound" class="font-bold text-indigo-700"></span> to <span id="upperBound" class="font-bold text-indigo-700"></span></p>
            <p class="text-sm text-gray-600 mt-2 text-center">Degrees of Freedom <span tabindex="-1" aria-hidden="true">$(df)$</span>: <span id="degreesOfFreedom" class="font-bold text-gray-700"></span></p>
            <p class="text-sm text-gray-600 mt-1 text-center">Critical t-value <span tabindex="-1" aria-hidden="true">$(t_{critical})$</span>: <span id="criticalTValue" class="font-bold text-gray-700"></span></p>
        </div>
    </div>

    <script>
        // Get references to elements
        const meanInput = document.getElementById('mean');
        const stdDevInput = document.getElementById('stdDev');
        const sampleSizeInput = document.getElementById('sampleSize');
        const confidenceLevelInput = document.getElementById('confidenceLevel'); // New confidence level input
        const calculateBtn = document.getElementById('calculateBtn');
        const resultsDiv = document.getElementById('results');
        const lowerBoundSpan = document.getElementById('lowerBound');
        const upperBoundSpan = document.getElementById('upperBound');
        const displayConfidenceLevelSpan = document.getElementById('displayConfidenceLevel'); // Span to display confidence level
        const degreesOfFreedomSpan = document.getElementById('degreesOfFreedom');
        const criticalTValueSpan = document.getElementById('criticalTValue');
        const errorMessageDiv = document.getElementById('errorMessage');

        /**
         * Displays an error message within the application.
         * @param {string} message - The message to display.
         */
        function displayError(message) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.classList.remove('hidden'); // Show the error message
        }

        /**
         * Clears the displayed error message.
         */
        function clearError() {
            errorMessageDiv.textContent = '';
            errorMessageDiv.classList.add('hidden'); // Hide the error message
        }

        /**
         * Calculates the confidence interval.
         */
        calculateBtn.addEventListener('click', () => {
            clearError(); // Clear any previous error messages
            resultsDiv.classList.add('hidden'); // Hide previous results

            const mean = parseFloat(meanInput.value);
            const stdDev = parseFloat(stdDevInput.value);
            const sampleSize = parseInt(sampleSizeInput.value);
            const confidenceLevel = parseFloat(confidenceLevelInput.value); // Get confidence level

            // Input validation
            if (isNaN(mean) || isNaN(stdDev) || isNaN(sampleSize) || isNaN(confidenceLevel)) {
                displayError('Please enter valid numerical values for all fields.');
                return;
            }

            if (stdDev < 0) {
                displayError('Standard deviation cannot be negative.');
                return;
            }

            if (sampleSize <= 1) {
                displayError('Sample size must be greater than 1 for t-distribution.');
                return;
            }

            if (confidenceLevel <= 0 || confidenceLevel >= 100) {
                displayError('Confidence level must be greater than 0 and less thanb 100.');
                return;
            }

            // Calculate degrees of freedom
            const degreesOfFreedom = sampleSize - 1;

            // Calculate alpha (significance level)
            const alpha = (100 - confidenceLevel) / 100;

            // Calculate p_value for jStat.studentt.inv (1 - alpha/2 for two-tailed test)
            const p_value = 1 - (alpha / 2);

            let criticalTValue;
            try {
                criticalTValue = jStat.studentt.inv(p_value, degreesOfFreedom);
            } catch (error) {
                console.error("Error calculating critical t-value:", error);
                displayError('Could not calculate critical t-value. Please check your inputs, especially sample size.');
                return;
            }

            // Calculate standard error
            const standardError = stdDev / Math.sqrt(sampleSize);

            // Calculate margin of error
            const marginOfError = criticalTValue * standardError;

            // Calculate confidence interval bounds
            const lowerBound = mean - marginOfError;
            const upperBound = mean + marginOfError;

            // Display results, rounded to 4 decimal places for clarity
            lowerBoundSpan.textContent = lowerBound.toFixed(4);
            upperBoundSpan.textContent = upperBound.toFixed(4);
            displayConfidenceLevelSpan.textContent = `${confidenceLevel}%`; // Display chosen confidence level
            degreesOfFreedomSpan.textContent = degreesOfFreedom;
            criticalTValueSpan.textContent = criticalTValue.toFixed(4); // Display t-value rounded

            // Show the results div
            resultsDiv.classList.remove('hidden');
        });
    </script>
</body>
</html>
